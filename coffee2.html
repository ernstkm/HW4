<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Coffee2</title>
    <script type="text/javascript" src="d3/d3.js"></script>
  </head>
  <body>
    <script type="text/javascript">

          var w = 600;
          var h = 600;
          var color = d3.scale.category20();
          var root;

          var canvas = d3.select("body").append("svg")
            .attr("width", w)
            .attr("height", h);

          var treemap = d3.layout.treemap()
            .size([w, h])
            .sticky(true)
            .children(function(d){ return d.values; })
            .value(function(d) {return +d.sales;})
            .padding(1);

      d3.csv("https://hivelab.org/static/coffee.csv", function(error, data){
          root = d3.nest()
            .key(function(){return "rootNode";})
            .key(function(d){ return d.caffeination;})
            .key(function(d){ return d.region;      })
          /*  .key(function(d){ return d.state;       })*/
          /*  .rollup(function(leaves){
              return {"totSales":d3.sum(leaves,function(d){
                return parseFloat(d.sales)
                })};
              })*/
            .entries(data);

          console.log(root);


              var cell = canvas.data(root)
                  .selectAll("g")
                  .data(treemap.nodes)
                .enter().append("g")
                  .attr("class", "cell")
                  .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });

              cell.append("rect")
                  .attr("width", function(d) { return d.dx; })
                  .attr("height", function(d) { return d.dy; })
                  .style("fill", function(d) { return color(d.values)})
                /*  .style("fill", "steelblue")*/;

              cell.append("text")
                  .attr("x", function(d) { return d.dx / 2; })
                  .attr("y", function(d) { return d.dy / 2; })
                  .attr("dy", ".35em")
                  .attr("text-anchor", "middle")
                  .text(function(d) { return d.children ? null : d.values; });;
            });

      </script>
    </body>
  </html>
