<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Coffee</title>
    <script type="text/javascript" src="d3/d3.js"></script>
  </head>
  <body>
    <script type="text/javascript">
      var color = d3.scale.category20();

      var canvas = d3.select("body").append("svg")
        .attr("width", 600)
        .attr("height", 600);
      d3.csv("https://hivelab.org/static/coffee.csv", function(data){
        console.log("Got Data");
        var nested_data = d3.nest()
          .key(function(d){ return d.region;      })
          .key(function(d){ return d.state;       })
          .key(function(d){ return d.caffeination;})
          .key(function(d){ return d.category;    })
          .rollup(function(leaves){
            return {"totSales":d3.sum(leaves,function(d){
              return parseInt(d.sales);    })
                                                  }}
          )
          .entries(data);
        console.log(nested_data[0]);

        var treemap = d3.layout.treemap()
          .size([600, 600])
          .sticky(true)
          .children(function (d) {return d.values;})
          .value(function(d) {return +d.totSales;})
          .nodes(nested_data)
        console.log("got treemap");
        console.log(treemap);

        var cells = canvas.selectAll(".cell")
          .data(treemap)
          .enter()
          .append("g")
          .attr("class", "cell")

        cells.append("rect")
          .attr("x", function(d){ return d.x;})
          .attr("y", function(d){ return d.y;})
          .attr("dx", function(d){ return d.dx;})
          .attr("dy", function(d){ return d.dy;})
          .attr("fill", "darkgray")
          .attr("stroke", "white");

      })/*


var width = 960,
    height = 500 - margin.top - margin.bottom;

var x = d3.scale.linear()
    .domain([0,width])
    .range([0, width]);

var treemap = d3.layout.treemap()
    .round(false)
    .size([width, height])
    .sticky(true)
    .value(function(d) {return d.sales;});

var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height+ margin.bottom + margin.top)
    ;

d3.csv("https://hivelab.org/static/coffee.csv", function(d){
      console.log("got data");
      var nested_data = d3.nest()
        .key(function(d){ return d.region;      })
        .key(function(d){ return d.state;       })
        .key(function(d){ return d.caffeination;})
        .key(function(d){ return d.category;    })
        .rollup(function(leaves){
          return {"totSales":d3.sum(leaves,function(d){
            return parseInt(d.sales);    })
                                                }}
        )
        .entries(d);

      console.log(nested_data[0]);
    })
*/
    </script>
  </body>
</html>
